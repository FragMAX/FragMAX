{% extends 'fragview/base.html' %}

{% load static %}
{% block title %}FragMAX - Dataset info{% endblock %}
{% block content %}
<meta name="viewport" content="width=device-width, user-scalable=no">
<meta name="theme-color" content="#333333">

<style>
    td,
    th {
        padding: 5px 5px;
        display: table-cell;
        text-align: left;
        vertical-align: middle;
        border-radius: 2px;
        font-size: 12px;

    }

    #resultsTable th {
        cursor: pointer;
    }

    .resultsHeader {
        text-align: center;
        font-size: 16px;
        font-weight: bold;
    }

    .top-options {
        font-size: 15px !important;
    }

    .content {
        margin: auto !important;
        max-width: 100% !important;
        width: 100% !important;
    }

    .card-content-left {
        padding: 0px 0px 38px 0px !important;
    }

    .card-content-right {
        padding: 24px 24px 28px 24px !important;
    }

    .card_options {
        padding-left: 310px !important;
        max-width: calc(100% - 50px) !important;
    }

    .flexdiv {
        display: flex;
        padding-left: 300px;
        max-width: calc(100% - 50px) !important;
    }

    .flexdiv_options {
        display: flex;
    }

    .flex-left {
        max-width: 750px;
        width: 33%
    }

    .flex-right {
        margin-left: 10px;
        max-width: 750px;
        width: 33%
    }

    .flex-center {
        margin-left: 10px;
        max-width: 750px;
        width: 33%
    }


    .crystalsnap {
        max-width: 400px;
        padding: 10px;
    }

    .diffimg {
        max-width: 100%;
        height: auto;
        width: auto\9;
        /* ie8 */
    }

    .diffsnap {
        max-width: 400px;
        padding: 10px;
    }

    .flexdiv_snapshot {
        display: flex;
    }

    #snaps {
        width: 800px;
        height: 800px;
        margin: 0 auto;
    }

    #snaps>img {
        float: left;
        width: 45%;
        margin: 1.66%;
    }

    .selectbox {
        display: flex !important;
    }

    .optionstable {
        border-collapse: separate;
        border-spacing: 0;
    }

    .tableSoak {
        border-collapse: separate;
        border-spacing: 0;
        width: 100% !important;

    }

    .tableInfo {
        width: 100% !important;
    }

    .bottom-right {
        right: 30;
        bottom: 20;
        position: absolute;
    }

    .btn-right {
        float: right !important;
    }

    .maxivorange {
        background-color: #fea901;
    }

    .custompar {
        background-color: #f0f0f0;
    }

    .ligpng {
        height: 25%;
        left: 53%;
        position: absolute;
        bottom: 3%;
    }

    .card-title {
        display: inline-flex !important;
    }

    button.link {
        font-family: "Verdana"sans-serif;
        font-size: 1.1em;
        text-align: left;
        color: #039be5;
        background: none;
        margin: 0;
        padding: 0;
        border: none;
        cursor: pointer;
    }

    .logtab {
        padding-bottom: 20px;
    }
</style>

<style>
    .myImg {
        cursor: pointer;
    }

    /* The Modal (background) */
    .modal {
        display: none;
        /* Hidden by default */
        position: fixed;
        /* Stay in place */
        z-index: 1;
        /* Sit on top */
        padding-top: 100px;
        /* Location of the box */
        max-height: 100%;
        left: 250px;
        top: 0;
        width: calc(100% - 200px);
        /* Full width */
        height: 100%;
        /* Full height */
        overflow: auto;
        /* Enable scroll if needed */
        background-color: rgb(0, 0, 0);
        /* Fallback color */
        background-color: rgba(0, 0, 0, 0.7);
        /* Black w/ opacity */
    }

    /* Modal Content (image) */
    .modal-content {
        margin: auto;
        display: block;
        max-height: 960px;
    }


    /* Style the tab */
    .tab {
        overflow: hidden;

        background-color: #f1f1f1;
    }

    /* Style the buttons inside the tab */
    .tab button {
        background-color: inherit;
        float: left;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 14px 16px;
        transition: 0.3s;
        font-size: 17px;
    }



    /* Create an active/current tablink class */
    .tab button.active {
        background-color: #fea901;
    }

    /* Style the tab content */
    .tabcontent {
        display: none;
        padding: 6px 12px;
    }


    #processingTable tr:nth-child(even) {
        background-color: #e2e2e2;
    }

    #resultsTable tr:nth-child(even) {
        background-color: #e2e2e2;
    }
</style>

<style>
    * {
        box-sizing: border-box
    }

    body {
        font-family: "Lato", sans-serif;
    }

    /* Style the tab */
    .tab-vertical {
        float: inherit;

        background-color: #f1f1f1;
        width: 150px;

        max-height: 100%;
    }

    /* Style the buttons inside the tab */
    .tab-vertical button {
        display: block;
        background-color: inherit;
        color: black;
        padding: 22px 16px;
        width: 150px;

        border: none;
        outline: none;
        text-align: left;
        cursor: pointer;
        transition: 0.3s;
        font-size: 17px;
    }

    /* Change background color of buttons on hover */
    .tab-vertical button:hover {
        background-color: #ddd;

    }

    /* Create an active/current "tab button" class */
    .tab-vertical button.active {
        background-color: #82be00;

    }

    /* Style the tab content */
    .tabcontent-vertical {
        padding: 0px 12px;
        width: 100%;
        border-left: none;
        display: none;
    }

    .tab-div-log {
        display: flex;
        margin: 6px;
    }
</style>

<body>

    <div>
        <h5 style="padding-left:310px;"> {{imgprf}}_{{run}} Dataset information </h5>


    </div>


    <!-- The Modal -->
    <div id="myModal" class="modal">
        <span class="close">&times;</span>
        <img class="modal-content" id="img01">
        <div id="caption"></div>
    </div>

    <div class="card_options">
        <div class="card tab">
            <button class="tablinks" onclick="openMethod(event, 'dataProcess')">Data Processing</button>
            <button class="tablinks" onclick="openMethod(event, 'structRefinement')">Structure Refinement</button>
        </div>
        <div id="dataProcess" class="card tabcontent ">
            <table class="optionstable" id="processingTable">
                <thead>
                    <tr>
                        <td class="resultsHeader" style="height: 60px;"></td>
                        <td class="resultsHeader">

                            {% if autoprocOK == "ready" %}
                            <form action="/procReport/" method="get" size="1" style="margin-top: 10px;" target="_blank">
                                <button class="btn-small" type="submit" value="{{autoprocreport}}" name="logFile"
                                    size="1">autoPROC</button>
                            </form>
                            {% else %}
                            autoPROC
                            {% endif %} </td>
                        <td class="resultsHeader">

                            {% if ednaOK == "ready" %}
                            <form action="/log_viewer/" method="get" id="logFileform" style="margin-top: 10px;"
                                target="_blank">
                                <button class="btn-small" type="submit" value="{{ednareport}}" name="logFile"
                                    size="1">EDNA</button>
                            </form>
                            {% else %}
                            EDNA
                            {% endif %}
                        </td>
                        <td class="resultsHeader">

                            {% if fastdpOK == "ready" %}
                            <form action="/log_viewer/" method="get" id="logFileform" style="margin-top: 10px;"
                                target="_blank">
                                <button class="btn-small" type="submit" value="{{fastdpreport}}" name="logFile"
                                    size="1">FastDP</button>
                            </form>
                            {% else %}
                            FastDP
                            {% endif %}
                        </td>
                        <td class="resultsHeader">

                            {% if xdsappOK == "ready" %}
                            <form action="/log_viewer/" method="get" id="logFileform" style="margin-top: 10px;"
                                target="_blank">
                                <button class="btn-small" type="submit" value="{{xdsappreport}}" name="logFile"
                                    size="1">XDSAPP</button>
                            </form>
                            {% else %}
                            XDSAPP
                            {% endif %}
                        </td>
                        <td class="resultsHeader">

                            {% if dialsOK == "ready" %}
                            <form action="/procReport/" method="get" size="1" style="margin-top: 10px;" target="_blank">
                                <button class="btn-small" type="submit" value="{{dialsreport}}" name="logFile"
                                    size="1">XIA2/DIALS</button>
                            </form>
                            {% else %}
                            XIA2/DIALS
                            {% endif %}
                        </td>
                        <td class="resultsHeader">

                            {% if xdsOK == "ready" %}
                            <form action="/procReport/" method="get" size="1" style="margin-top: 10px;" target="_blank">
                                <button class="btn-small" type="submit" value="{{xdsreport}}" name="logFile"
                                    size="1">XIA2/XDS</button>
                            </form>
                            {% else %}
                            XIA2/XDS
                            {% endif %}
                        </td>
                        <td class="resultsHeader">
                            {% if pipedreamOK == "ready" %}
                            <form action="/log_viewer/" method="get" id="logFileform" style="margin-top: 10px;"
                                target="_blank">
                                <button class="btn-small" type="submit" value="{{pipedreamreport}}" name="logFile"
                                    size="1">Pipedream</button>
                            </form>
                            {% else %}
                            Pipedream
                            {% endif %}

                        </td>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                    </tr>
                    <tr>
                        <td style="text-align:center; font-weight: bold; font-size: 14px; height: 60px;">Spacegroup</td>
                        {% for value in spg_list %}
                        <td style="text-align:center">{{value}}</td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td style="text-align:center; font-weight: bold; font-size: 14px; height: 60px;">Unit cell
                            parameters</td>
                        {% for dim, ang in unit_cell_list %}
                        <td style="text-align:center">
                            <div>{{dim}}</div>
                            <div> {{ang}}</div>
                        </td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td style="text-align:center; font-weight: bold; font-size: 14px; height: 60px;">Resolution
                            limit</td>
                        {% for inner, outter in resolution_list %}
                        <td style="text-align:center">{{inner}} {{outter}}</td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td style="text-align:center; font-weight: bold; font-size: 14px; height: 60px;">Number of
                            reflections</td>
                        {% for value in total_observations_list %}
                        <td style="text-align:center">{{value}}</td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td style="text-align:center; font-weight: bold; font-size: 14px; height: 60px;">Number of
                            uniques</td>
                        {% for value in unique_rflns_list %}
                        <td style="text-align:center">{{value}}</td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td style="text-align:center; font-weight: bold; font-size: 14px; height: 60px;">Multiplicity
                        </td>
                        {% for inner in multiplicity_list %}
                        <td style="text-align:center">{{inner}}</td>
                        {% endfor %}
                    </tr>

                    <tr>
                        <td style="text-align:center; font-weight: bold; font-size: 14px; height: 60px;">I/sigI</td>
                        {% for inner, outter in isgi_list %}
                        <td style="text-align:center">{{inner}} {{outter}}</td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td style="text-align:center; font-weight: bold; font-size: 14px; height: 60px;">R_meas</td>
                        {% for inner, outter in rmeas_list %}
                        <td style="text-align:center">{{inner}} {{outter}}</td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td style="text-align:center; font-weight: bold; font-size: 14px; height: 60px;">Completeness
                            [%]</td>
                        {% for inner, outter in completeness_list %}
                        <td style="text-align:center">{{inner}} {{outter}}</td>
                        {% endfor %}
                    </tr>
                    {% comment %} <tr>
                        <td style="text-align:center; font-weight: bold; font-size: 14px; height: 60px;">B(Wilson)
                            [A<sup>2</sup>]
                        </td>
                        {% for value in WilsonB_list %}
                        <td style="text-align:center">{{value}}</td>
                        {% endfor %}
                    </tr> {% endcomment %}
                    <tr>
                        <td style="text-align:center; font-weight: bold; font-size: 14px; height: 60px;">Mosaicity [°]
                        </td>
                        {% for value in mosaicity_list %}
                        <td style="text-align:center">{{value}}</td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td style="text-align:center; font-weight: bold; font-size: 14px; height: 60px;">ISa</td>
                        {% for value in ISa_list %}
                        <td style="text-align:center">{{value}}</td>
                        {% endfor %}
                    </tr>


                </tbody>

            </table>
        </div>
        <div id="structRefinement" class="card tabcontent ">

            <div class="card-content card-content-left">

                <table class="optionstable" id="resultsTable">
                    <thead>
                        <tr>
                            <td class="resultsHeader" style="height: 60px">View Structure</td>
                            <td class="resultsHeader">Data set</td>
                            <td class="resultsHeader">Space group</td>
                            <td class="resultsHeader">Res. [&Aring;]</td>
                            <td class="resultsHeader">R<sub>work</sub> </td>
                            <td class="resultsHeader">R<sub>free</sub> </td>
                            <td class="resultsHeader">RMS bonds [&Aring;]</td>
                            <td class="resultsHeader">RMS angles [&deg;]</td>
                            <td class="resultsHeader">a</td>
                            <td class="resultsHeader">b</td>
                            <td class="resultsHeader">c</td>
                            <td class="resultsHeader">&alpha;</td>
                            <td class="resultsHeader">&beta;</td>
                            <td class="resultsHeader">&gamma;</td>
                            <td class="resultsHeader">RhoFit</td>
                            <td class="resultsHeader">LigandFit</td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                        </tr>
                        {% for usracr,pdbout,dif_map,nat_map,spg,resolution,isa,r_work,r_free,bonds,angles,a,b,c,alpha,beta,gamma,blist,dataset,pipeline,rhofitscore,ligfitscore,ligblob, modelscore in csvfile %}

                        <tr>

                            <td style="text-align:center;padding-top: 10px;">
                                {% if "pipedream" not in usracr %}
                                <form action="/density/" method="get" target="_blank">
                                    <button class="btn" type="submit" value="{{usracr}}" name="structure"
                                        style="height: 48px; margin-top: 15px;"><i class="material-icons"
                                            style="font-size:28px;">3d_rotation</i></button>
                                </form>
                                {% else %}
                                <form action="/pipedream_density/" method="get" target="_blank">
                                    <button class="btn" type="submit" value="{{usracr}}" name="structure" size="1"
                                        style="height: 48px">
                                        <i class="material-icons" style="font-size:28px;">3d_rotation</i>
                                    </button>
                                </form>
                                {% endif %}

                            </td>
                            <td>{{usracr}}</td>
                            <td style="text-align:center">{{spg}}</td>
                            <td style="text-align:center">{{resolution}}</td>
                            <td style="text-align:center">{{r_work}}</td>
                            <td style="text-align:center">{{r_free}}</td>
                            <td style="text-align:center">{{bonds}}</td>
                            <td class="rms" style="text-align:center">{{angles}}</td>
                            <td style="text-align:center">{{a}}</td>
                            <td style="text-align:center">{{b}}</td>
                            <td style="text-align:center">{{c}}</td>
                            <td style="text-align:center">{{alpha}}</td>
                            <td style="text-align:center">{{beta}}</td>
                            <td style="text-align:center">{{gamma}}</td>
                            <td style="text-align:center">{{rhofitscore}}</td>
                            <td style="text-align:center">{{ligfitscore}}</td>

                        </tr>
                        {% endfor %}

                    </tbody>

                </table>
            </div>


        </div>
    </div>
    </div>


    <div class="flexdiv">
        <div id="snaps">
            {% if dialsOK == "ready" %}
            <form action="/reciprocal_lattice/{{imgprf}}/{{run}}" method="get" size="1" style="padding-left:25%;"
                target="_blank">
                <button class="btn-large" type="submit" size="1">Open Reciprocal Lattice Viewer</button>
            </form>
            {% endif %}

            <img class="myImg diffsnap" id="diff1" src="/diffraction/{{imgprf}}/{{run}}/1">
            <img class="myImg diffsnap" id="diff2" src="/diffraction/{{imgprf}}/{{run}}/{{diffraction_half}}">

            <img class="myImg crystalsnap" id="snap1" src="{{snapshots.0}}"
                onerror="if (this.src != '/static/img/nosnap.png') this.src='/static/img/nosnap.png';">
            <img class="myImg crystalsnap" id="snap2" src="{{snapshots.1}}"
                onerror="if (this.src != '/static/img/nosnap.png') this.src='/static/img/nosnap.png';">


        </div>
        <div class="flex-left">
            <div class="card" style="min-height:700px">
                <div class="card-content card-content-right">
                    <div class="card-title">Experiment parameters</div>
                    <table id="tableinfo1" class="tableInfo">
                        <col width="200">
                        <col width="450">
                        <tbody>
                            <tr>
                                <td style="font-weight: bold;">Img directory</td>
                                <td name="imgdirNAME" id="imgdirID">
                                    <p style="word-break: break-all;">
                                        {{xsdata.imageDirectory}}
                                    </p>
                                </td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Img prefix</td>
                                <td>{{project.protein}}</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Run number</td>
                                <td>{{run}}</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;"># of images</td>
                                <td>{{xsdata.numberOfImages}}</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Start time</td>
                                <td>{{xsdata.startTime}} </td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">End time</td>
                                <td>{{xsdata.endTime}}</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Type of experiment</td>
                                <td>OSC</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Wavelength</td>
                                <td>{{xsdata.wavelength|floatformat:6}} Å</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Energy</td>
                                <td>{{energy}} keV</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Phi Start</td>
                                <td>{{xsdata.axisStart}}°</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Oscillation range</td>
                                <td>{{xsdata.axisRange}}°</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Overlap</td>
                                <td>{{xsdata.overlap|floatformat:1}}°</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Exposure time</td>
                                <td>{{xsdata.exposureTime|floatformat:3}} s</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Total Exposure time</td>
                                <td>{{totalExposure}} s</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Estimated dose</td>
                                <td>Not defined</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Detector distance</td>
                                <td>{{xsdata.detectorDistance|floatformat:2}} mm</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Resolution at edge</td>
                                <td>{{xsdata.resolution|floatformat:2}} Å</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Resolution at corner</td>
                                <td>{{edgeResolution}} Å</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Xbeam</td>
                                <td>{{xsdata.xbeam}} mm</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Ybeam</td>
                                <td>{{xsdata.ybeam}} mm</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Kappa</td>
                                <td>0</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Phi</td>
                                <td>0</td>
                            </tr>

                        </tbody>

                    </table>
                </div>

            </div>
        </div>

        <div class="flex-right">
            <div class="card" style="min-height:700px">
                <div class="card-content card-content-right">
                    <div class="card-title">Beamline parameters</div>
                    <table id="tableinfo2" class="tableInfo">
                        <col width="200">
                        <col width="450">
                        <tbody>
                            <tr>
                                <td style="font-weight: bold;">Synchrotron</td>
                                <td>{{site.NAME}}</td>
                            </tr>
                            {% if xsdata.synchrotronMode %}
                            <tr>
                                <td style="font-weight: bold;">Filling mode</td>
                                <td>{{xsdata.synchrotronMode}}</td>
                            </tr>
                            {% endif %}
                            <tr>
                                <td style="font-weight: bold;">Beamline</td>
                                <td>{{beamline.name}}</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Detector type</td>
                                <td>{{beamline.detector_type}}</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Detector model</td>
                                <td>{{beamline.detector_model}}</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Detector pixel size (HxV)</td>
                                <td>{{beamline.detector_pixel_size}}</td>
                            </tr>
                            {% if beamline.focusing_optics %}
                            <tr>
                                <td style="font-weight: bold;">Focusing optics</td>
                                <td>{{beamline.focusing_optics}}</td>
                            </tr>
                            {% endif %}
                            {% if beamline.monochrom_type %}
                            <tr>
                                <td style="font-weight: bold;">Monochromator type</td>
                                <td>{{beamline.monochrom_type}}</td>
                            </tr>
                            {% endif %}
                            <tr>
                                <td style="font-weight: bold;">Beam shape</td>
                                <td>{{xsdata.beamShape}}</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Beam transmission</td>
                                <td>{{xsdata.transmission|floatformat:3}}%</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Slit gap hor</td>
                                <td>{{xsdata.slitGapHorizontal|floatformat:1}} μm</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Slit gap ver</td>
                                <td>{{xsdata.slitGapVertical|floatformat:1}} μm</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Flux (estimated)</td>
                                <td>{{xsdata.flux|stringformat:".3e" }} ph/s</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Beam size at sample (HxV)</td>
                                <td>{{xsdata.beamSizeSampleX}} μm x {{xsdata.beamSizeSampleY}} μm</td>
                            </tr>
                            {% if beamline.beam_divergence %}
                            <tr>
                                <td style="font-weight: bold;">Beam divergence (HxV)</td>
                                <td>{{beamline.beam_divergence}}</td>
                            </tr>
                            {% endif %}
                            {% if beamline.polarisation %}
                            <tr>
                                <td style="font-weight: bold;">Polarisation</td>
                                <td>{{beamline.polarisation}}</td>
                            </tr>
                            {% endif %}
                        </tbody>
                    </table>
                    <br>
                    {% if soakTime == "Soaking not performed" %}
                    <div hidden>
                        {% else %}
                        <div>
                            {% endif %}
                            <div class="card-title">Soaking parameters</div>
                            <div>
                                <table class="tableSoak">
                                    <col width="320">
                                    <col width="300">
                                    <col width="450">
                                    <tbody>
                                        <tr>
                                            <td style="font-weight: bold;">Soaking time</td>
                                            <td>{{soakTime}} </td>

                                        </tr>
                                        <tr>
                                            <td style="font-weight: bold;">Fragment Concentration</td>
                                            <td>{{fragConc}}</td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td style="font-weight: bold;">DMSO Concentration (final)</td>
                                            <td>{{solventConc}}</td>
                                            <td></td>
                                        </tr>
                                    </tbody>
                                </table>
                                <img class="ligpng" id="ligand" src="/fragment/{{ligand}}/image"
                                    onerror="if (this.src != '/static/img/nolig.png') this.src='/static/img/nolig.png';">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <h5 style="padding-left:310px;">Advanced log viewer</h5>

        <div class=" card_options">
            <div class="card tab">
                <button class="tablinks" onclick="openMethod(event, 'EDNA')">EDNA_proc</button>
                <button class="tablinks" onclick="openMethod(event, 'fastdp')">FastDP</button>
                <button class="tablinks" onclick="openMethod(event, 'DIALS')">DIALS</button>
                <button class="tablinks" onclick="openMethod(event, 'XDS_XSCALE')">XDS/XSCALE</button>
                <button class="tablinks" onclick="openMethod(event, 'XDSAPP')">XDSAPP</button>
                <button class="tablinks" onclick="openMethod(event, 'autoPROC')">autoPROC</button>

                <button class="tablinks" onclick="openMethod(event, 'Pipedream')">Pipedream</button>

                <button class="tablinks" onclick="openMethod(event, 'BUSTER')">BUSTER</button>
                <button class="tablinks" onclick="openMethod(event, 'DIMPLE')">DIMPLE</button>
                <button class="tablinks" onclick="openMethod(event, 'FSPipeline')">fspipeline</button>

                {% comment %} <button class="tablinks" onclick="openMethod(event, 'RhoFit')">RhoFit</button>
                <button class="tablinks" onclick="openMethod(event, 'LigFit')">LigandFit</button>
                {% endcomment %}


            </div>
            <div id="EDNA" class="card tabcontent ">
                <div class="card-title logtab">EDNA_proc Logs</div>
                {% if ednaOK == "ready" %}
                {% for logName,logPath in ednaLogs %}
                <form {% if "html" in logPath %} action="/procReport/" {% else %} action="/log_viewer/" {% endif %}
                    method="get" style="padding-left:20px; " target="_blank">
                    <button class="link" type="submit" value="{{logPath}}" name="logFile" size="1">{{logName}}</button>
                </form>
                {% endfor %}
                {% endif %}
            </div>
            <div id="fastdp" class="card tabcontent ">
                <div class="card-title logtab">FastDP Logs</div>
                {% if fastdpOK == "ready" %}
                {% for logName,logPath in fastdpLogs %}
                <form {% if "html" in logPath %} action="/procReport/" {% else %} action="/log_viewer/" {% endif %}
                    method="get" style="padding-left:20px; " target="_blank">
                    <button class="link" type="submit" value="{{logPath}}" name="logFile" size="1">{{logName}}</button>
                </form>
                {% endfor %}
                {% endif %}
            </div>
            <div id="DIALS" class="card tabcontent ">
                <div class="card-title logtab">XIA2/Dials Logs</div>
                {% if dialsOK == "ready" %}
                {% for logName,logPath in dialsLogs %}
                <form {% if "html" in logPath %} action="/procReport/" {% else %} action="/log_viewer/" {% endif %}
                    method="get" style="padding-left:20px; " target="_blank">
                    <button class="link" type="submit" value="{{logPath}}" name="logFile" size="1">{{logName}}</button>
                </form>
                {% endfor %}
                {% endif %}
            </div>
            <div id="XDS_XSCALE" class="card tabcontent ">
                <div class="card-title logtab">XIA2/XDS_xscale Logs</div>
                {% if xdsOK == "ready" %}
                {% for logName,logPath in xdsLogs %}
                <form {% if "html" in logPath %} action="/procReport/" {% else %} action="/log_viewer/" {% endif %}
                    method="get" style="padding-left:20px; " target="_blank">
                    <button class="link" type="submit" value="{{logPath}}" name="logFile" size="1">{{logName}}</button>
                </form>
                {% endfor %}
                {% endif %}
            </div>
            <div id="XDSAPP" class="card tabcontent ">
                <div class="card-title logtab">XDSAPP Logs</div>
                {% if xdsappOK == "ready" %}
                {% for logName,logPath in xdsappLogs %}
                <form {% if "html" in logPath %} action="/procReport/" {% else %} action="/log_viewer/" {% endif %}
                    method="get" style="padding-left:20px; " target="_blank">
                    <button class="link" type="submit" value="{{logPath}}" name="logFile" size="1">{{logName}}</button>
                </form>
                {% endfor %}
                {% endif %}
            </div>
            <div id="autoPROC" class="card tabcontent ">
                <div class="card-title logtab">autoPROC Logs</div>
                {% if autoprocOK == "ready" %}
                {% for logName,logPath in autoprocLogs %}
                <form {% if "html" in logPath %} action="/procReport/" {% else %} action="/log_viewer/" {% endif %}
                    method="get" style="padding-left:20px; " target="_blank">
                    <button class="link" type="submit" value="{{logPath}}" name="logFile" size="1">{{logName}}</button>
                </form>
                {% endfor %}
                {% endif %}
            </div>
            <div id="Pipedream" class="card tabcontent">
                <div class="card-title">Pipedream Logs</div>
                <div class="tab-div-log">
                    <div class="tab-vertical">
                        <button class="tablinks-vertical"
                            onclick="openMethodV(event, 'pipedream-pipedream-v')">Pipedream</button>
                        <button class="tablinks-vertical"
                            onclick="openMethodV(event, 'autoproc-pipedream-v')">autoPROC</button>
                        <button class="tablinks-vertical"
                            onclick="openMethodV(event, 'buster-pipedream-v')">BUSTER</button>
                        <button class="tablinks-vertical"
                            onclick="openMethodV(event, 'rhofit-pipedream-v')">RhoFit</button>
                    </div>
                    <div id="pipedream-pipedream-v" class="tabcontent-vertical">
                        {% for proc_m, logs in pipedream_logs.items %}
                        {% if proc_m == "pipedream" %}
                        {% for log, path in logs.items %}
                        <form {% if "html" in path %} action="/procReport/" {% else %} action="/log_viewer/" {% endif %}
                            method="get" style="padding-left:20px; " target="_blank">
                            <button class="link" type="submit" value="{{path}}" name="logFile" size="1">{{log}}</button>
                        </form>
                        {% endfor %}
                        {% endif %}
                        {% endfor %}
                    </div>
                    <div id="autoproc-pipedream-v" class="tabcontent-vertical">
                        {% for proc_m, logs in pipedream_logs.items %}
                        {% if proc_m == "autoproc" %}
                        {% for log, path in logs.items %}
                        <form {% if "html" in path %} action="/procReport/" {% else %} action="/log_viewer/" {% endif %}
                            method="get" style="padding-left:20px; " target="_blank">
                            <button class="link" type="submit" value="{{path}}" name="logFile" size="1">{{log}}</button>
                        </form>
                        {% endfor %}
                        {% endif %}
                        {% endfor %}
                    </div>

                    <div id="buster-pipedream-v" class="tabcontent-vertical">
                        {% for proc_m, logs in pipedream_logs.items %}
                        {% if proc_m == "buster" %}
                        {% for log, path in logs.items %}
                        <form {% if "html" in path %} action="/procReport/" {% else %} action="/log_viewer/" {% endif %}
                            method="get" style="padding-left:20px; " target="_blank">
                            <button class="link" type="submit" value="{{path}}" name="logFile" size="1">{{log}}</button>
                        </form>
                        {% endfor %}
                        {% endif %}
                        {% endfor %}
                    </div>
                    <div id="rhofit-pipedream-v" class="tabcontent-vertical">
                        {% for proc_m, logs in pipedream_logs.items %}
                        {% if proc_m == "rhofit" %}
                        {% for log, path in logs.items %}
                        <form {% if "html" in path %} action="/procReport/" {% else %} action="/log_viewer/" {% endif %}
                            method="get" style="padding-left:20px; " target="_blank">
                            <button class="link" type="submit" value="{{path}}" name="logFile" size="1">{{log}}</button>
                        </form>
                        {% endfor %}
                        {% endif %}
                        {% endfor %}
                    </div>

                </div>
            </div>
            <div id="DIMPLE" class="card tabcontent">
                <div class="card-title">DIMPLE Logs</div>
                <div class="tab-div-log">
                    <div class="tab-vertical">
                        <button class="tablinks-vertical"
                            onclick="openMethodV(event, 'autoproc-dimple-v')">autoPROC</button>
                        <button class="tablinks-vertical"
                            onclick="openMethodV(event, 'enda-dimple-v')">EDNA_proc</button>
                        <button class="tablinks-vertical"
                            onclick="openMethodV(event, 'fastdp-dimple-v')">FastDP</button>
                        <button class="tablinks-vertical"
                            onclick="openMethodV(event, 'xia2dials-dimple-v')">XIA2/Dials</button>
                        <button class="tablinks-vertical"
                            onclick="openMethodV(event, 'xia2xds-dimple-v')">XIA2/XDS</button>
                        <button class="tablinks-vertical"
                            onclick="openMethodV(event, 'xdsapp-dimple-v')">XDSAPP</button>
                    </div>
                    <div id="autoproc-dimple-v" class="tabcontent-vertical">
                        {% for proc_m, logs in dimple_logs.items %}
                        {% if proc_m == "autoproc" %}
                        {% for log, path in logs.items %}
                        <form {% if "html" in path %} action="/procReport/" {% else %} action="/log_viewer/" {% endif %}
                            method="get" style="padding-left:20px; " target="_blank">
                            <button class="link" type="submit" value="{{path}}" name="logFile" size="1">{{log}}</button>
                        </form>
                        {% endfor %}
                        {% endif %}
                        {% endfor %}
                    </div>

                    <div id="enda-dimple-v" class="tabcontent-vertical">
                        {% for proc_m, logs in dimple_logs.items %}
                        {% if proc_m == "edna" %}
                        {% for log, path in logs.items %}
                        <form {% if "html" in path %} action="/procReport/" {% else %} action="/log_viewer/" {% endif %}
                            method="get" style="padding-left:20px; " target="_blank">
                            <button class="link" type="submit" value="{{path}}" name="logFile" size="1">{{log}}</button>
                        </form>
                        {% endfor %}
                        {% endif %}
                        {% endfor %}
                    </div>
                    <div id="fastdp-dimple-v" class="tabcontent-vertical">
                        {% for proc_m, logs in dimple_logs.items %}
                        {% if proc_m == "fastdp" %}
                        {% for log, path in logs.items %}
                        <form {% if "html" in path %} action="/procReport/" {% else %} action="/log_viewer/" {% endif %}
                            method="get" style="padding-left:20px; " target="_blank">
                            <button class="link" type="submit" value="{{path}}" name="logFile" size="1">{{log}}</button>
                        </form>
                        {% endfor %}
                        {% endif %}
                        {% endfor %}
                    </div>
                    <div id="xia2dials-dimple-v" class="tabcontent-vertical">
                        {% for proc_m, logs in dimple_logs.items %}
                        {% if proc_m == "dials" %}
                        {% for log, path in logs.items %}
                        <form {% if "html" in path %} action="/procReport/" {% else %} action="/log_viewer/" {% endif %}
                            method="get" style="padding-left:20px; " target="_blank">
                            <button class="link" type="submit" value="{{path}}" name="logFile" size="1">{{log}}</button>
                        </form>
                        {% endfor %}
                        {% endif %}
                        {% endfor %}
                    </div>
                    <div id="xia2xds-dimple-v" class="tabcontent-vertical">
                        {% for proc_m, logs in dimple_logs.items %}
                        {% if proc_m == "xdsxscale" %}
                        {% for log, path in logs.items %}
                        <form {% if "html" in path %} action="/procReport/" {% else %} action="/log_viewer/" {% endif %}
                            method="get" style="padding-left:20px; " target="_blank">
                            <button class="link" type="submit" value="{{path}}" name="logFile" size="1">{{log}}</button>
                        </form>
                        {% endfor %}
                        {% endif %}
                        {% endfor %}
                    </div>
                    <div id="xdsapp-dimple-v" class="tabcontent-vertical">
                        {% for proc_m, logs in dimple_logs.items %}
                        {% if proc_m == "xdsapp" %}
                        {% for log, path in logs.items %}
                        <form {% if "html" in path %} action="/procReport/" {% else %} action="/log_viewer/" {% endif %}
                            method="get" style="padding-left:20px; " target="_blank">
                            <button class="link" type="submit" value="{{path}}" name="logFile" size="1">{{log}}</button>
                        </form>
                        {% endfor %}
                        {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div id="BUSTER" class="card tabcontent">
                <div class="card-title">BUSTER Logs</div>
                <div class="tab-div-log">
                    <div class="tab-vertical">
                        <button class="tablinks-vertical"
                            onclick="openMethodV(event, 'autoproc-buster-v')">autoPROC</button>
                        <button class="tablinks-vertical"
                            onclick="openMethodV(event, 'enda-buster-v')">EDNA_proc</button>
                        <button class="tablinks-vertical"
                            onclick="openMethodV(event, 'fastdp-buster-v')">FastDP</button>
                        <button class="tablinks-vertical"
                            onclick="openMethodV(event, 'xia2dials-buster-v')">XIA2/Dials</button>
                        <button class="tablinks-vertical"
                            onclick="openMethodV(event, 'xia2xds-buster-v')">XIA2/XDS</button>
                        <button class="tablinks-vertical"
                            onclick="openMethodV(event, 'xdsapp-buster-v')">XDSAPP</button>
                    </div>
                    <div id="autoproc-buster-v" class="tabcontent-vertical">
                        {% for proc_m, logs in buster_logs.items %}
                        {% if proc_m == "autoproc" %}
                        {% for log, path in logs.items %}
                        <form {% if "html" in path %} action="/procReport/" {% else %} action="/log_viewer/" {% endif %}
                            method="get" style="padding-left:20px; " target="_blank">
                            <button class="link" type="submit" value="{{path}}" name="logFile" size="1">{{log}}</button>
                        </form>
                        {% endfor %}
                        {% endif %}
                        {% endfor %}
                    </div>

                    <div id="enda-buster-v" class="tabcontent-vertical">
                        {% for proc_m, logs in buster_logs.items %}
                        {% if proc_m == "edna" %}
                        {% for log, path in logs.items %}
                        <form {% if "html" in path %} action="/procReport/" {% else %} action="/log_viewer/" {% endif %}
                            method="get" style="padding-left:20px; " target="_blank">
                            <button class="link" type="submit" value="{{path}}" name="logFile" size="1">{{log}}</button>
                        </form>
                        {% endfor %}
                        {% endif %}
                        {% endfor %}
                    </div>
                    <div id="fastdp-buster-v" class="tabcontent-vertical">
                        {% for proc_m, logs in buster_logs.items %}
                        {% if proc_m == "fastdp" %}
                        {% for log, path in logs.items %}
                        <form {% if "html" in path %} action="/procReport/" {% else %} action="/log_viewer/" {% endif %}
                            method="get" style="padding-left:20px; " target="_blank">
                            <button class="link" type="submit" value="{{path}}" name="logFile" size="1">{{log}}</button>
                        </form>
                        {% endfor %}
                        {% endif %}
                        {% endfor %}
                    </div>
                    <div id="xia2dials-buster-v" class="tabcontent-vertical">
                        {% for proc_m, logs in buster_logs.items %}
                        {% if proc_m == "dials" %}
                        {% for log, path in logs.items %}
                        <form {% if "html" in path %} action="/procReport/" {% else %} action="/log_viewer/" {% endif %}
                            method="get" style="padding-left:20px; " target="_blank">
                            <button class="link" type="submit" value="{{path}}" name="logFile" size="1">{{log}}</button>
                        </form>
                        {% endfor %}
                        {% endif %}
                        {% endfor %}
                    </div>
                    <div id="xia2xds-buster-v" class="tabcontent-vertical">
                        {% for proc_m, logs in buster_logs.items %}
                        {% if proc_m == "xdsxscale" %}
                        {% for log, path in logs.items %}
                        <form {% if "html" in path %} action="/procReport/" {% else %} action="/log_viewer/" {% endif %}
                            method="get" style="padding-left:20px; " target="_blank">
                            <button class="link" type="submit" value="{{path}}" name="logFile" size="1">{{log}}</button>
                        </form>
                        {% endfor %}
                        {% endif %}
                        {% endfor %}
                    </div>
                    <div id="xdsapp-buster-v" class="tabcontent-vertical">
                        {% for proc_m, logs in buster_logs.items %}
                        {% if proc_m == "xdsapp" %}
                        {% for log, path in logs.items %}
                        <form {% if "html" in path %} action="/procReport/" {% else %} action="/log_viewer/" {% endif %}
                            method="get" style="padding-left:20px; " target="_blank">
                            <button class="link" type="submit" value="{{path}}" name="logFile" size="1">{{log}}</button>
                        </form>
                        {% endfor %}
                        {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div id="FSPipeline" class="card tabcontent">
                <div class="card-title">fspipeline Logs</div>
                <div class="tab-div-log">
                    <div class="tab-vertical">
                        <button class="tablinks-vertical"
                            onclick="openMethodV(event, 'autoproc-fspipeline-v')">autoPROC</button>
                        <button class="tablinks-vertical"
                            onclick="openMethodV(event, 'enda-fspipeline-v')">EDNA_proc</button>
                        <button class="tablinks-vertical"
                            onclick="openMethodV(event, 'fastdp-fspipeline-v')">FastDP</button>
                        <button class="tablinks-vertical"
                            onclick="openMethodV(event, 'xia2dials-fspipeline-v')">XIA2/Dials</button>
                        <button class="tablinks-vertical"
                            onclick="openMethodV(event, 'xia2xds-fspipeline-v')">XIA2/XDS</button>
                        <button class="tablinks-vertical"
                            onclick="openMethodV(event, 'xdsapp-fspipeline-v')">XDSAPP</button>
                    </div>
                    <div id="autoproc-fspipeline-v" class="tabcontent-vertical">
                        {% for proc_m, logs in fspipeline_logs.items %}
                        {% if proc_m == "autoproc" %}
                        {% for log, path in logs.items %}
                        <form {% if "html" in path %} action="/procReport/" {% else %} action="/log_viewer/" {% endif %}
                            method="get" style="padding-left:20px; " target="_blank">
                            <button class="link" type="submit" value="{{path}}" name="logFile" size="1">{{log}}</button>
                        </form>
                        {% endfor %}
                        {% endif %}
                        {% endfor %}
                    </div>

                    <div id="enda-fspipeline-v" class="tabcontent-vertical">
                        {% for proc_m, logs in fspipeline_logs.items %}
                        {% if proc_m == "edna" %}
                        {% for log, path in logs.items %}
                        <form {% if "html" in path %} action="/procReport/" {% else %} action="/log_viewer/" {% endif %}
                            method="get" style="padding-left:20px; " target="_blank">
                            <button class="link" type="submit" value="{{path}}" name="logFile" size="1">{{log}}</button>
                        </form>
                        {% endfor %}
                        {% endif %}
                        {% endfor %}
                    </div>
                    <div id="fastdp-fspipeline-v" class="tabcontent-vertical">
                        {% for proc_m, logs in fspipeline_logs.items %}
                        {% if proc_m == "fastdp" %}
                        {% for log, path in logs.items %}
                        <form {% if "html" in path %} action="/procReport/" {% else %} action="/log_viewer/" {% endif %}
                            method="get" style="padding-left:20px; " target="_blank">
                            <button class="link" type="submit" value="{{path}}" name="logFile" size="1">{{log}}</button>
                        </form>
                        {% endfor %}
                        {% endif %}
                        {% endfor %}
                    </div>
                    <div id="xia2dials-fspipeline-v" class="tabcontent-vertical">
                        {% for proc_m, logs in fspipeline_logs.items %}
                        {% if proc_m == "dials" %}
                        {% for log, path in logs.items %}
                        <form {% if "html" in path %} action="/procReport/" {% else %} action="/log_viewer/" {% endif %}
                            method="get" style="padding-left:20px; " target="_blank">
                            <button class="link" type="submit" value="{{path}}" name="logFile" size="1">{{log}}</button>
                        </form>
                        {% endfor %}
                        {% endif %}
                        {% endfor %}
                    </div>
                    <div id="xia2xds-fspipeline-v" class="tabcontent-vertical">
                        {% for proc_m, logs in fspipeline_logs.items %}
                        {% if proc_m == "xdsxscale" %}
                        {% for log, path in logs.items %}
                        <form {% if "html" in path %} action="/procReport/" {% else %} action="/log_viewer/" {% endif %}
                            method="get" style="padding-left:20px; " target="_blank">
                            <button class="link" type="submit" value="{{path}}" name="logFile" size="1">{{log}}</button>
                        </form>
                        {% endfor %}
                        {% endif %}
                        {% endfor %}
                    </div>
                    <div id="xdsapp-fspipeline-v" class="tabcontent-vertical">
                        {% for proc_m, logs in fspipeline_logs.items %}
                        {% if proc_m == "xdsapp" %}
                        {% for log, path in logs.items %}
                        <form {% if "html" in path %} action="/procReport/" {% else %} action="/log_viewer/" {% endif %}
                            method="get" style="padding-left:20px; " target="_blank">
                            <button class="link" type="submit" value="{{path}}" name="logFile" size="1">{{log}}</button>
                        </form>
                        {% endfor %}
                        {% endif %}
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% comment %} <div id="RhoFit" class="card tabcontent">
                <div class="card-title">RhoFit Logs</div>
                <p>file 1</p>
                <p>file 2</p>
            </div>
            <div id="LigFit" class="card tabcontent">
                <div class="card-title">LigandFit Logs</div>
                <p>file 1</p>
                <p>file 2</p>
            </div>
            <div id="Pipedream" class="card tabcontent">
                <div class="card-title">Pipedream Logs</div>
                <p>file 1</p>
                <p>file 2</p>
            </div> {% endcomment %}

        </div>

</body>

<script>
    // Get the modal
    var modal = document.getElementById('myModal');

    // Get the image and insert it inside the modal - use its "alt" text as a caption
    var img = document.getElementById('diff1');
    var img2 = document.getElementById('diff2');
    var img3 = document.getElementById('snap1');
    var img4 = document.getElementById('snap2');

    var modalImg = document.getElementById("img01");

    img.onclick = function () {
        modal.style.display = "block";
        modalImg.src = this.src;
        captionText.innerHTML = this.alt;
    }
    img2.onclick = function () {
        modal.style.display = "block";
        modalImg.src = this.src;
        captionText.innerHTML = this.alt;
    }
    img3.onclick = function () {
        modal.style.display = "block";
        modalImg.src = this.src;
        captionText.innerHTML = this.alt;
    }
    img4.onclick = function () {
        modal.style.display = "block";
        modalImg.src = this.src;
        captionText.innerHTML = this.alt;
    }
    window.onclick = function (event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }

    const getCellValue = (tr, idx) => tr.children[idx].innerText || tr.children[idx].textContent;

    const comparer = (idx, asc) => (a, b) => ((v1, v2) =>
        v1 !== '' && v2 !== '' && !isNaN(v1) && !isNaN(v2) ? v1 - v2 : v1.toString().localeCompare(v2)
    )(getCellValue(asc ? a : b, idx), getCellValue(asc ? b : a, idx));

    // do the work...
    document.querySelectorAll('th').forEach(th => th.addEventListener('click', (() => {
        const table = th.closest('table');
        Array.from(table.querySelectorAll('tr:nth-child(n+2)'))
            .sort(comparer(Array.from(th.parentNode.children).indexOf(th), this.asc = !this.asc))
            .forEach(tr => table.appendChild(tr));
    })));
</script>


<script>
    function openMethod(evt, methodName) {
        if (document.getElementById(methodName).style.display == "block") {
            document.getElementById(methodName).style.display = "none"
            evt.currentTarget.className = evt.currentTarget.className.replace(" active", '');
        } else {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(methodName).style.display = "block";
            evt.currentTarget.className += " active";
        }
    }
</script>

<script>
    function openMethodV(evt, methodName) {
        if (document.getElementById(methodName).style.display == "block") {
            document.getElementById(methodName).style.display = "none"
            evt.currentTarget.className = evt.currentTarget.className.replace(" active", '');
        } else {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent-vertical");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks-vertical");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(methodName).style.display = "block";
            evt.currentTarget.className += " active";
        }
    }
</script>
{% endblock %}