{% extends 'fragview/base.html' %} {% block title %}FragMAX - Home{% endblock %} {% block content %} {% load static %} {% comment %} Define dataset run number
<- Edit CSV file and update views {% endcomment %} <style>

    th { cursor: pointer; text-align: center; } td, th { border: 1px solid #f0f0f0; padding: 8px; text-align: center; } tr:nth-child(even) { background-color: #dddddd; height: 150px; } .container { margin: 0 50px 50px 300px !important; max-width: 100% !important;
    width: calc(100% - 350px) !important; } .crystalsnap { max-width: 100%; max-height: 180px; } .ligpng { height:144px; width:144px; } .color-legend { line-height: 0.8 !important; position: absolute; right: 80px; top: 20px; } img { cursor: pointer; }
    /* The Modal (background) */


    </style>

    <style>
        .modal {
            display: none;
            /* Hidden by default */
            position: fixed;
            /* Stay in place */
            z-index: 1;
            /* Sit on top */
            left: 0;
            top: 0;
            width: 100%;
            /* Full width */
            height: 100%;
            /* Full height */
            max-height: 100% !important;
            overflow: auto;
            /* Enable scroll if needed */
            background-color: rgb(0, 0, 0);
            /* Fallback color */
            background-color: rgba(0, 0, 0, 0.3);
            /* Black w/ opacity */
            backdrop-filter: blur(6px);
        }
        /* Modal Content (image) */
        
        .modal-content {
            margin: auto;
            display: flex;
            max-width: 50%;
        }
        /* Add Animation */
        
        .modal-content {
            -webkit-animation-name: zoom;
            -webkit-animation-duration: 0.2s;
            animation-name: zoom;
            animation-duration: 0.2s;
        }
        
        @-webkit-keyframes zoom {
            from {
                -webkit-transform: scale(0)
            }
            to {
                -webkit-transform: scale(1)
            }
        }
        
        @keyframes zoom {
            from {
                transform: scale(0)
            }
            to {
                transform: scale(1)
            }
        }
        /* 100% Image Width on Smaller Screens */
        
        @media only screen and (max-width: 700px) {
            .modal-content {
                width: 100%;
            }
        }
    </style>
    <div id="myModal" class="modal">
        <img class="modal-content" id="SnapshotModal">
        <img class="modal-content" id="SnapshotModal2">

    </div>
    <div>
        <h4>Data Collection Overview</h4>
        <div style="display:flex;">
            <form action="/datasets/" method="get" id="procButton" style="padding-left:20px; ">
                <button class="btn" type="submit" value="resyncStatus" name="resyncstButton" size="1">Update Project Database</button>
            </form>
        </div>
        <div class="color-legend">
            <p align="left">
                <font size="6" color="#82be00">&#9679;</font>
                <font size="4"> Successful</font>
            </p>
            <p align="left">
                <font size="6" color="#fdd835">&#9679;</font>
                <font size="4"> Not started</font>
            </p>
            <p align="left">
                <font size="6" color="#f44336">&#9679;</font>
                <font size="4"> Failed</font>
            </p>
        </div>
    </div>
    <p></p>

    <div class="input-field col s12" id="searchDiv">
        <i class="material-icons prefix">search</i>
        <input type="text" id="searchSample" onkeyup="searchSampleName()" title="Type in a sample name">
        <label for="searchSample">Search for Sample names..</label>
    </div>

    <table id="datasetTable">
        <thead>
            <tr>
                <th>Info/Process</th>
                <th>Protein</th>
                <th>Sample name</th>
                <th>Run</th>

                <th>Proc Status</th>
                <th>Ref Status</th>
                <th>Lig Status</th>

                <th>Resolution</sub> [&Aring;]</th>
                <th>Frames</th>
                {% comment %}
                <th>Path</th> {% endcomment %}
                <th>Crystal Picture</th>
                <th>Ligand</th>

            </tr>
        </thead>
        <tbody>

            <tr>
            </tr>
            {% for img,prf,res,path,snap,snap2,acr,fragment,run,smp,dps,rfs,lgs in datasets %}
            <tr>
                <td>

                    <form action="/dataset_info/" method="get" id={{prf}}>
                        <button class="btn" type="submit" value={{prf}};{{img}};{{run}} name="proteinPrefix" size="1">Info</button>
                    </form>

                </td>
                <td>
                    <p>{{ acr }}</p>
                </td>
                <td>
                    <p>{{ smp }}</p>
                </td>
                <td>
                    <p>{{ run }}</p>
                </td>
                {{dps| safe}} {{rfs| safe}} {{lgs | safe}}
                <td>
                    <p>{{ res }}</p>
                </td>
                <td>
                    <p>{{ img }}</p>
                </td>
                {% comment %}
                <td>
                    <p>{{ path }}{{ acr }}_{{run}}_master.h5</p>
                </td> {% endcomment %}


                <td>
                    {% if snap != "noSnapshots" %}
                    <img class="crystalsnap" id="snap1-{{smp}}_{{run}}" src={{ snap }} onerror="if (this.src != '') this.src='';"> {% endif %} {% if snap2 != "noSnapshots" %}
                    <img class="crystalsnap" id="snap2-{{smp}}_{{run}}" src={{ snap2 }} onerror="if (this.src != '') this.src='';"> {% endif %}

                </td>

                <td>
                    {% if fragment %}
                    <a href="/fragment/{{ fragment }}/image" target="_blank">
                        <img class="ligpng" src="/fragment/{{ fragment }}/image">
                    </a>
                    {% endif %}

                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>


    </tbody>

    </table>
    <script>
      const getCellValue = (tr, idx) => tr.children[idx].innerText || tr.children[idx].textContent;
      const comparer = (idx, asc) => (a, b) => ((v1, v2) =>
          v1 !== '' && v2 !== '' && !isNaN(v1) && !isNaN(v2) ? v1 - v2 : v1.toString().localeCompare(v2)
          )(getCellValue(asc ? a : b, idx), getCellValue(asc ? b : a, idx));
      
      // do the work...
      document.querySelectorAll('th').forEach(th => th.addEventListener('click', (() => {
          const table = th.closest('table');
          Array.from(table.querySelectorAll('tr:nth-child(n+2)'))
              .sort(comparer(Array.from(th.parentNode.children).indexOf(th), this.asc = !this.asc))
              .forEach(tr => table.appendChild(tr) );
      })));
      function searchSampleName() {
              var input, filter, table, tr, td, i, txtValue;
              input = document.getElementById("searchSample");
              filter = input.value.toUpperCase();
              table = document.getElementById("datasetTable");
              tr = table.getElementsByTagName("tr");
              for (i = 0; i < tr.length; i++) {
                  td = tr[i].getElementsByTagName("td")[2];
                  if (td) {
                  txtValue = td.textContent || td.innerText;
                  if (txtValue.toUpperCase().indexOf(filter) > -1) {
                      tr[i].style.display = "";
                  } else {
                      tr[i].style.display = "none";
                  }
                  }
              }
              }
      
      var modal = document.getElementById("myModal");
      
      // Get the image and insert it inside the modal - use its "alt" text as a caption
      
      var modalImg = document.getElementById("SnapshotModal");
      var modalImg2 = document.getElementById("SnapshotModal2");
      
      
      
      {% for img,prf,res,path,snap,snap2,acr,fragment,run,smp,dps,rfs,lgs in datasets %}
      
      {% if snap != "noSnapshots" %}
      var snap1{{smp}}{{run}} = document.getElementById("snap1-{{smp}}_{{run}}");
      var snap2{{smp}}{{run}} = document.getElementById("snap2-{{smp}}_{{run}}");
      
      snap1{{smp}}{{run}}.onclick = function(){
        modal.style.display = "flex";
        modalImg.src = snap1{{smp}}{{run}}.src;
        modalImg2.src = snap2{{smp}}{{run}}.src;
      }
      snap2{{smp}}{{run}}.onclick = function(){
        modal.style.display = "flex";
        modalImg.src = snap1{{smp}}{{run}}.src;
        modalImg2.src = snap2{{smp}}{{run}}.src;
      }
      {% endif %}
      {% endfor %}
      // Get the <span> element that closes the modal
      var span = document.getElementsByClassName("close")[0];
      
      // When the user clicks on <span> (x), close the modal
      
          window.onclick = function (event) {
                  if (event.target == modal) {
                      modal.style.display = "none";
                  }
              }
          $(document).ready(function(){
              $(document).bind("keydown", function(e){
                  e = e || window.event;
                  var charCode = e.which || e.keyCode;
                  if(charCode == 27) {
                      modal.style.display = "none";
                  };
              });
          });
      </script>

    {% endblock %}