{% extends 'base.html' %}
{% block title %}Dataset Info{% endblock %}
{% block content %}
<meta name="viewport" content="width=device-width, user-scalable=no">
<meta name="theme-color" content="#333333">

<style>
    td,
    th {
        padding: 5px 5px;
        display: table-cell;
        text-align: left;
        vertical-align: middle;
        border-radius: 2px;
        font-size: 12px;

    }

    #resultsTable th {
        cursor: pointer;
    }

    .resultsHeader {
        text-align: center;
        font-size: 16px;
    }

    .top-options {
        font-size: 15px !important;
    }

    .content {
        margin: auto !important;
        max-width: 100% !important;
        width: 100% !important;
    }

    .card-content-left {
        padding: 0px 0px 38px 0px !important;
    }

    .card-content-right {
        padding: 24px 24px 28px 24px !important;
    }

    .card_options {
        padding-left: 310px !important;
        max-width: calc(100% - 50px) !important;
    }

    .flexdiv {
        display: flex;
        padding-left: 300px;
        max-width: calc(100% - 50px) !important;
    }

    .flexdiv_options {
        display: flex;
    }

    .flex-left {
        max-width: 750px;
        width: 33%
    }

    .flex-right {
        margin-left: 10px;
        max-width: 750px;
        width: 33%
    }

    .flex-center {
        margin-left: 10px;
        max-width: 750px;
        width: 33%
    }


    .crystalsnap {
        max-width: 400px;
        padding: 10px;
    }

    .diffimg {
        max-width: 100%;
        height: auto;
        width: auto\9;
        /* ie8 */
    }

    .diffsnap {
        max-width: 400px;
        padding: 10px;
    }

    .flexdiv_snapshot {
        display: flex;
    }

    #snaps {
        width: 800px;
        height: 800px;
        margin: 0 auto;
    }

    #snaps>img {
        float: left;
        width: 45%;
        margin: 1.66%;
    }

    .selectbox {
        display: flex !important;
    }

    .optionstable {
        border-collapse: separate;
        border-spacing: 0;
        table-layout: fixed;
    }

    .optionsREFtable {
        border-collapse: separate;
        border-spacing: 0;
    }

    .tableSoak {
        border-collapse: separate;
        border-spacing: 0;
        width: 100% !important;

    }

    .tableInfo {
        width: 100% !important;
    }

    .bottom-right {
        right: 30;
        bottom: 20;
        position: absolute;
    }

    .btn-right {
        float: right !important;
    }

    .maxivorange {
        background-color: #fea901;
    }

    .custompar {
        background-color: #f0f0f0;
    }

    .card-title {
        display: inline-flex !important;
    }

    button.link {
        font-family: "Verdana"sans-serif;
        font-size: 1.1em;
        text-align: left;
        color: #039be5;
        background: none;
        margin: 0;
        padding: 0;
        border: none;
        cursor: pointer;
    }

    .logtab {
        padding-bottom: 20px;
    }

    .log-name {
        padding-left:20px;
    }

    .myImg {
        cursor: pointer;
    }

    /* The Modal (background) */
    .modal {
        display: none;
        /* Hidden by default */
        position: fixed;
        /* Stay in place */
        z-index: 1;
        /* Sit on top */
        padding-top: 100px;
        /* Location of the box */
        max-height: 100%;
        left: 250px;
        top: 0;
        width: calc(100% - 200px);
        /* Full width */
        height: 100%;
        /* Full height */
        overflow: auto;
        /* Enable scroll if needed */
        background-color: rgb(0, 0, 0);
        /* Fallback color */
        background-color: rgba(0, 0, 0, 0.7);
        /* Black w/ opacity */
    }

    /* Modal Content (image) */
    .modal-content {
        margin: auto;
        display: block;
        max-height: 960px;
    }


    /* Style the tab */
    .tab {
        overflow: hidden;

        background-color: #f1f1f1;
    }

    /* Style the buttons inside the tab */
    .tab button {
        background-color: inherit;
        float: left;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 14px 16px;
        transition: 0.3s;
        font-size: 17px;
    }

    /* Create an active/current tablink class */
    .tab button.active {
        background-color: #fea901;
    }

    /* Style the tab content */
    .tabcontent {
        display: none;
        padding: 6px 12px;
    }


    #processingTable tr:nth-child(even) {
        background-color: #e2e2e2;
    }

    #resultsTable tr:nth-child(even) {
        background-color: #e2e2e2;
    }

    * {
        box-sizing: border-box
    }

    body {
        font-family: "Lato", sans-serif;
    }

    /* Style the tab */
    .tab-vertical {
        float: inherit;

        background-color: #f1f1f1;
        width: 150px;

        max-height: 100%;
    }

    /* Style the buttons inside the tab */
    .tab-vertical button {
        display: block;
        background-color: inherit;
        color: black;
        padding: 22px 16px;
        width: 150px;

        border: none;
        outline: none;
        text-align: left;
        cursor: pointer;
        transition: 0.3s;
        font-size: 17px;
    }

    /* Change background color of buttons on hover */
    .tab-vertical button:hover {
        background-color: #ddd;

    }

    /* Create an active/current "tab button" class */
    .tab-vertical button.active {
        background-color: #82be00;

    }

    /* Style the tab content */
    .tabcontent-vertical {
        padding: 0px 12px;
        width: 100%;
        border-left: none;
        display: none;
    }

    .tab-div-log {
        display: flex;
        margin: 6px;
    }
</style>

<body>
    <div>
        <h5 style="padding-left:310px;">{{dataset.name}} Dataset information</h5>
    </div>

    <!-- The Modal -->
    <div id="myModal" class="modal">
        <span class="close">&times;</span>
        <img class="modal-content" id="img01">
        <div id="caption"></div>
    </div>

    <div class="card_options">
        <div class="card tab">
            <button class="tablinks" onclick="openMethod(event, 'dataProcess')">Data Processing</button>
            <button class="tablinks" onclick="openMethod(event, 'structRefinement')">Structure Refinement</button>
        </div>
        <div id="dataProcess" class="card tabcontent ">
            <table class="optionstable" id="processingTable">
                <thead>
                    <tr>
                        <td class="resultsHeader" style="height: 60px;"></td>
                        {% for entry in processing_stats %}
                        <td class="resultsHeader">
                            <div class="btn-small">
                                {{entry.tool_name}}
                            </div>
                        </td>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    <tr></tr>
                    <tr>
                        <td style="text-align:center; font-weight: bold; font-size: 14px; height: 60px;">Spacegroup</td>
                        {% for entry in processing_stats %}
                        <td style="text-align:center">{{entry.space_group.short_name}}</td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td style="text-align:center; font-weight: bold; font-size: 14px; height: 60px;">Unit cell parameters</td>
                        {% for entry in processing_stats %}
                        <td style="text-align:center">
                            <div>
                                {{entry.unit_cell_a|floatformat:2}}
                                {{entry.unit_cell_b|floatformat:2}}
                                {{entry.unit_cell_c|floatformat:2}}
                            </div>
                            <div>
                                {{entry.unit_cell_alpha|floatformat:2}}
                                {{entry.unit_cell_beta|floatformat:2}}
                                {{entry.unit_cell_gamma|floatformat:2}}
                            </div>
                        </td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td style="text-align:center; font-weight: bold; font-size: 14px; height: 60px;">Resolution limit</td>
                        {% for entry in processing_stats %}
                        <td style="text-align:center">
                            <div>
                                {{entry.low_resolution_overall|floatformat:2}} - {{entry.high_resolution_overall|floatformat:2}}
                            </div>
                            <div>
                                ({{entry.low_resolution_out|floatformat:2}} - {{entry.high_resolution_out|floatformat:2}})
                            </div>
                        </td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td style="text-align:center; font-weight: bold; font-size: 14px; height: 60px;">
                            Number of reflections
                        </td>
                        {% for entry in processing_stats %}
                            <td style="text-align:center">{{entry.reflections}}</td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td style="text-align:center; font-weight: bold; font-size: 14px; height: 60px;">
                            Unique reflections
                        </td>
                        {% for entry in processing_stats %}
                            <td style="text-align:center">{{entry.unique_reflections}}</td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td style="text-align:center; font-weight: bold; font-size: 14px; height: 60px;">
                            Multiplicity
                        </td>
                        {% for entry in processing_stats %}
                            <td style="text-align:center">{{entry.multiplicity|floatformat:1}}</td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td style="text-align:center; font-weight: bold; font-size: 14px; height: 60px;">I/sigI</td>
                        {% for entry in processing_stats %}
                            <td style="text-align:center">
                                {{entry.i_sig_average|floatformat:1}} ({{entry.i_sig_out|floatformat:1}})
                            </td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td style="text-align:center; font-weight: bold; font-size: 14px; height: 60px;">R_meas</td>
                        {% for entry in processing_stats %}
                            <td style="text-align:center">
                                {{entry.r_meas_average|floatformat:3}} ({{entry.r_meas_out|floatformat:3}})
                            </td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td style="text-align:center; font-weight: bold; font-size: 14px; height: 60px;">
                            Completeness [%]
                        </td>
                        {% for entry in processing_stats %}
                            <td style="text-align:center">
                                {{entry.completeness_average|floatformat:1}} ({{entry.completeness_out|floatformat:1}})
                            </td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td style="text-align:center; font-weight: bold; font-size: 14px; height: 60px;">
                            Mosaicity [°]
                        </td>
                        {% for entry in processing_stats %}
                            <td style="text-align:center">
                                {{entry.mosaicity|floatformat:3}}
                            </td>
                        {% endfor %}
                    </tr>
                    <tr>
                        <td style="text-align:center; font-weight: bold; font-size: 14px; height: 60px;">
                            ISa
                        </td>
                        {% for entry in processing_stats %}
                            <td style="text-align:center">
                                {% if entry.isa %}
                                {{entry.isa|floatformat:2}}
                                {% endif %}
                            </td>
                        {% endfor %}
                    </tr>
                </tbody>
            </table>
        </div>
        <div id="structRefinement" class="card tabcontent ">

            <div class="card-content card-content-left">

                <table class="optionsREFtable" id="resultsTable">
                    <thead>
                        <tr>
                            <td class="resultsHeader" style="height: 60px">View Structure</td>
                            <td class="resultsHeader">Data set</td>
                            <td class="resultsHeader">Space group</td>
                            <td class="resultsHeader">Res. [&Aring;]</td>
                            <td class="resultsHeader">R<sub>work</sub> </td>
                            <td class="resultsHeader">R<sub>free</sub> </td>
                            <td class="resultsHeader">RMS bonds [&Aring;]</td>
                            <td class="resultsHeader">RMS angles [&deg;]</td>
                            <td class="resultsHeader">a</td>
                            <td class="resultsHeader">b</td>
                            <td class="resultsHeader">c</td>
                            <td class="resultsHeader">&alpha;</td>
                            <td class="resultsHeader">&beta;</td>
                            <td class="resultsHeader">&gamma;</td>
                            <td class="resultsHeader">RhoFit</td>
                            <td class="resultsHeader">LigandFit</td>
                        </tr>
                    </thead>
                    <tbody>
                        {% for refine in refine_results %}
                        <tr>
                            <td style="text-align:center;padding-top: 10px;">
                                <a href="/density/{{refine.id}}" target="_blank">
                                    <button class="btn" style="height: 48px; margin-top: 15px;">
                                        <i class="material-icons"style="font-size:28px; padding-top: 6px;">3d_rotation</i>
                                    </button>
                                </a>
                            </td>
                            <td>{{refine.name}}</td>
                            <td style="text-align:center">{{refine.space_group}}</td>
                            <td style="text-align:center">{{refine.resolution|floatformat:2}}</td>
                            <td style="text-align:center">{{refine.r_work|floatformat:2}}</td>
                            <td style="text-align:center">{{refine.r_free|floatformat:2}}</td>
                            <td style="text-align:center">{{refine.rms_bonds|floatformat:3}}</td>
                            <td class="rms" style="text-align:center">{{refine.rms_angles|floatformat:3}}</td>
                            <td style="text-align:center">{{refine.unit_cell_a|floatformat:3}}</td>
                            <td style="text-align:center">{{refine.unit_cell_b|floatformat:3}}</td>
                            <td style="text-align:center">{{refine.unit_cell_c|floatformat:3}}</td>
                            <td style="text-align:center">{{refine.unit_cell_alpha|floatformat:3}}</td>
                            <td style="text-align:center">{{refine.unit_cell_beta|floatformat:3}}</td>
                            <td style="text-align:center">{{refine.unit_cell_gamma|floatformat:3}}</td>
                            <td style="text-align:center">{{refine.rhofit_score|floatformat:3}}</td>
                            <td style="text-align:center">{{refine.ligandfit_score|floatformat:3}}</td>
                        </tr>
                        {% endfor %}

                    </tbody>

                </table>
            </div>


        </div>
    </div>
    </div>

    <div class="flexdiv">
        <div id="snaps">
            <img class="myImg diffsnap" id="diff1" src="/diffraction/{{dataset.id}}/0">
            <img class="myImg diffsnap" id="diff2" src="/diffraction/{{dataset.id}}/90">

            {% for snapshot in dataset.snapshots %}
            <img class="myImg crystalsnap"
                 id="snap{{snapshot.index}}"
                 src="/dataset/{{dataset.id}}/snapshot/{{snapshot.index}}"/>
            {% endfor %}

            {% if snapshots %}
            <img class="myImg crystalsnap" id="snap1" src="{{snapshots.0}}"
                onerror="if (this.src != '/static/img/nosnap.png') this.src='/static/img/nosnap.png';">
            <img class="myImg crystalsnap" id="snap2" src="{{snapshots.1}}"
                onerror="if (this.src != '/static/img/nosnap.png') this.src='/static/img/nosnap.png';">
            {% endif %}

            {% with fragment=dataset.fragment %}
                {% if fragment %}
                <img src="/fragment/{{fragment.id}}/image">
                {% endif %}
            {% endwith %}
        </div>
        <div class="flex-left">
            <div class="card" style="min-height:700px">
                <div class="card-content card-content-right">
                    <div class="card-title">Experiment parameters</div>
                    <table id="tableinfo1" class="tableInfo">
                        <col width="200">
                        <col width="450">
                        <tbody>
                            <tr>
                                <td style="font-weight: bold;">Run number</td>
                                <td>{{dataset.run}}</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;"># of images</td>
                                <td>{{dataset.images}}</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Start time</td>
                                <td>{{dataset.start_time|date:"Y-m-d H:i:s"}} (UTC)</td>
                            </tr>
                            {% if dataset.end_time %}
                            <tr>
                                <td style="font-weight: bold;">End time</td>
                                <td>{{dataset.end_time|date:"Y-m-d H:i:s"}} (UTC)</td>
                            </tr>
                            {% endif %}
                            <tr>
                                <td style="font-weight: bold;">Type of experiment</td>
                                <td>OSC</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Wavelength</td>
                                <td>{{dataset.wavelength|floatformat:6}} Å</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Energy</td>
                                <td>{{energy|floatformat:2}} keV</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Starting angle</td>
                                <td>{{dataset.start_angle|floatformat:1}}°</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Angle increment</td>
                                <td>{{dataset.angle_increment|floatformat:1}}°</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Total rotation</td>
                                <td>{{total_rotation|floatformat:1}}°</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Exposure time</td>
                                <td>{{dataset.exposure_time|floatformat:3}} s</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Total Exposure time</td>
                                <td>{{total_exposure|floatformat:2}} s</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Detector distance</td>
                                <td>{{dataset.detector_distance|floatformat:2}} mm</td>
                            </tr>
                            {% if dataset.xbeam %}
                            <tr>
                                <td style="font-weight: bold;">Xbeam</td>
                                <td>{{dataset.xbeam|floatformat:2}} mm</td>
                            </tr>
                            {% endif %}
                            {% if dataset.ybeam %}
                            <tr>
                                <td style="font-weight: bold;">Ybeam</td>
                                <td>{{dataset.ybeam|floatformat:2}} mm</td>
                            </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>

            </div>
        </div>

        <div class="flex-right">
            <div class="card" style="min-height:700px">
                <div class="card-content card-content-right">
                    <div class="card-title">Beamline parameters</div>
                    <table id="tableinfo2" class="tableInfo">
                        <col width="200">
                        <col width="450">
                        <tbody>
                            <tr>
                                <td style="font-weight: bold;">Synchrotron</td>
                                <td>{{site.NAME}}</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Beamline</td>
                                <td>{{dataset.beamline}}</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Detector type</td>
                                <td>{{beamline.detector_type}}</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Detector model</td>
                                <td>{{dataset.detector}}</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Detector pixel size (HxV)</td>
                                <td>{{beamline.detector_pixel_size}}</td>
                            </tr>
                            {% if beamline.focusing_optics %}
                            <tr>
                                <td style="font-weight: bold;">Focusing optics</td>
                                <td>{{beamline.focusing_optics}}</td>
                            </tr>
                            {% endif %}
                            {% if beamline.monochrom_type %}
                            <tr>
                                <td style="font-weight: bold;">Monochromator type</td>
                                <td>{{beamline.monochrom_type}}</td>
                            </tr>
                            {% endif %}
                            <tr>
                                <td style="font-weight: bold;">Beam shape</td>
                                <td>{{dataset.beam_shape}}</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Beam transmission</td>
                                <td>{{dataset.transmission|floatformat:3}}%</td>
                            </tr>
                            {% if dataset.slit_gap_horizontal %}
                            <tr>
                                <td style="font-weight: bold;">Slit gap hor</td>
                                <td>{{dataset.slit_gap_horizontal|floatformat:1}} μm</td>
                            </tr>
                            {% endif %}
                            {% if dataset.slit_gap_vertical %}
                            <tr>
                                <td style="font-weight: bold;">Slit gap ver</td>
                                <td>{{dataset.slit_gap_vertical|floatformat:1}} μm</td>
                            </tr>
                            {% endif %}
                            <tr>
                                <td style="font-weight: bold;">Flux (estimated)</td>
                                <td>{{dataset.flux|stringformat:".3e"}} ph/s</td>
                            </tr>
                            <tr>
                                <td style="font-weight: bold;">Beam size at sample (HxV)</td>
                                <td>{{dataset.beam_size_at_sample_x|floatformat:1}} μm x {{dataset.beam_size_at_sample_y|floatformat:1}} μm</td>
                            </tr>
                            {% if beamline.beam_divergence %}
                            <tr>
                                <td style="font-weight: bold;">Beam divergence (HxV)</td>
                                <td>{{beamline.beam_divergence}}</td>
                            </tr>
                            {% endif %}
                            {% if beamline.polarisation %}
                            <tr>
                                <td style="font-weight: bold;">Polarisation</td>
                                <td>{{beamline.polarisation}}</td>
                            </tr>
                            {% endif %}
                        </tbody>
                    </table>
                    </div>
                </div>
            </div>
        </div>

        <h5 style="padding-left:310px;">Advanced log viewer</h5>

        <div class=" card_options">
            <div class="card tab">
                {% if proc_logs.edna %}
                    <button class="tablinks" onclick="openMethod(event, 'EDNA')">EDNA_proc</button>
                {% endif %}
                {% if proc_logs.dials %}
                    <button class="tablinks" onclick="openMethod(event, 'DIALS')">XIA2/DIALS</button>
                {% endif %}
                {% if proc_logs.xds %}
                    <button class="tablinks" onclick="openMethod(event, 'XDS')">XIA2/XDS</button>
                {% endif %}
                {% if proc_logs.xdsapp %}
                    <button class="tablinks" onclick="openMethod(event, 'XDSAPP')">XDSAPP</button>
                {% endif %}
                {% if proc_logs.autoproc %}
                    <button class="tablinks" onclick="openMethod(event, 'autoPROC')">autoPROC</button>
                {% endif %}
                {% if refine_logs.dimple %}
                    <button class="tablinks" onclick="openMethod(event, 'DIMPLE')">DIMPLE</button>
                {% endif %}
                {% if refine_logs.fspipeline %}
                    <button class="tablinks" onclick="openMethod(event, 'FSPipeline')">fspipeline</button>
                {% endif %}
            </div>
            <div id="EDNA" class="card tabcontent">
                <div class="card-title logtab">EDNA_proc Logs</div>
                {% for log_file in proc_logs.edna %}
                    <div>
                        <a href="/logs/show/{{log_file}}" class="log-name" target="_blank">
                            {{log_file.name}}
                        </a>
                    </div>
                {% endfor %}
            </div>
            <div id="DIALS" class="card tabcontent">
                <div class="card-title logtab">XIA2/DIALS Logs</div>
                {% for log_file in proc_logs.dials %}
                    <div>
                        <a href="/logs/show/{{log_file}}" class="log-name" target="_blank">
                            {{log_file.name}}
                        </a>
                    </div>
                {% endfor %}
            </div>
            <div id="XDS" class="card tabcontent">
                <div class="card-title logtab">XIA2/XDS Logs</div>
                {% for log_file in proc_logs.xds %}
                    <div>
                        <a href="/logs/show/{{log_file}}" class="log-name" target="_blank">
                            {{log_file.name}}
                        </a>
                    </div>
                {% endfor %}
            </div>
            <div id="XDSAPP" class="card tabcontent ">
                <div class="card-title logtab">XDSAPP Logs</div>
                {% for log_file in proc_logs.xdsapp %}
                    <div>
                        <a href="/logs/show/{{log_file}}" class="log-name" target="_blank">
                            {{log_file.name}}
                        </a>
                    </div>
                {% endfor %}
            </div>
            <div id="autoPROC" class="card tabcontent ">
                <div class="card-title logtab">autoPROC Logs</div>
                {% for log_file in proc_logs.autoproc %}
                    <div>
                        <a href="/logs/show/{{log_file}}" class="log-name" target="_blank">
                            {{log_file.name}}
                        </a>
                    </div>
                {% endfor %}
            </div>
            <div id="DIMPLE" class="card tabcontent">
                <div class="card-title">DIMPLE Logs</div>
                <div class="tab-div-log">
                    <div class="tab-vertical">
                        {% if refine_logs.dimple.autoproc %}
                        <button class="tablinks-vertical"
                            onclick="openMethodV(event, 'autoproc-dimple-v')">autoPROC</button>
                        {% endif %}
                        {% if refine_logs.dimple.edna %}
                        <button class="tablinks-vertical"
                            onclick="openMethodV(event, 'enda-dimple-v')">EDNA_proc</button>
                        {% endif %}
                        {% if refine_logs.dimple.dials %}
                        <button class="tablinks-vertical"
                            onclick="openMethodV(event, 'dials-dimple-v')">XIA2/DIALS</button>
                        {% endif %}
                        {% if refine_logs.dimple.xds %}
                        <button class="tablinks-vertical"
                            onclick="openMethodV(event, 'xds-dimple-v')">XIA2/XDS</button>
                        {% endif %}
                        {% if refine_logs.dimple.xdsapp %}
                        <button class="tablinks-vertical"
                            onclick="openMethodV(event, 'xdsapp-dimple-v')">XDSAPP</button>
                        {% endif %}
                    </div>
                    <div id="autoproc-dimple-v" class="tabcontent-vertical">
                        {% for log_file in refine_logs.dimple.autoproc %}
                            <div>
                                <a href="/logs/show/{{log_file}}" class="log-name" target="_blank">
                                    {{log_file.name}}
                                </a>
                            </div>
                        {% endfor %}
                    </div>
                    <div id="enda-dimple-v" class="tabcontent-vertical">
                        {% for log_file in refine_logs.dimple.edna %}
                            <div>
                                <a href="/logs/show/{{log_file}}" class="log-name" target="_blank">
                                    {{log_file.name}}
                                </a>
                            </div>
                        {% endfor %}
                    </div>
                    <div id="dials-dimple-v" class="tabcontent-vertical">
                        {% for log_file in refine_logs.dimple.dials %}
                            <div>
                                <a href="/logs/show/{{log_file}}" class="log-name" target="_blank">
                                    {{log_file.name}}
                                </a>
                            </div>
                        {% endfor %}
                    </div>
                    <div id="xds-dimple-v" class="tabcontent-vertical">
                        {% for log_file in refine_logs.dimple.xds %}
                            <div>
                                <a href="/logs/show/{{log_file}}" class="log-name" target="_blank">
                                    {{log_file.name}}
                                </a>
                            </div>
                        {% endfor %}
                    </div>
                    <div id="xdsapp-dimple-v" class="tabcontent-vertical">
                        {% for log_file in refine_logs.dimple.xdsapp %}
                            <div>
                                <a href="/logs/show/{{log_file}}" class="log-name" target="_blank">
                                    {{log_file.name}}
                                </a>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div id="FSPipeline" class="card tabcontent">
                <div class="card-title">fspipeline Logs</div>
                <div class="tab-div-log">
                    <div class="tab-vertical">
                        {% if refine_logs.fspipeline.autoproc %}
                        <button class="tablinks-vertical"
                            onclick="openMethodV(event, 'autoproc-fspipeline-v')">autoPROC</button>
                        {% endif %}
                        {% if refine_logs.fspipeline.edna %}
                        <button class="tablinks-vertical"
                            onclick="openMethodV(event, 'enda-fspipeline-v')">EDNA_proc</button>
                        {% endif %}
                        {% if refine_logs.fspipeline.xds %}
                        <button class="tablinks-vertical"
                            onclick="openMethodV(event, 'xds-fspipeline-v')">XIA2/XDS</button>
                        {% endif %}
                        {% if refine_logs.fspipeline.xdsapp %}
                        <button class="tablinks-vertical"
                            onclick="openMethodV(event, 'xdsapp-fspipeline-v')">XDSAPP</button>
                        {% endif %}
                    </div>
                    <div id="autoproc-fspipeline-v" class="tabcontent-vertical">
                        {% for log_file in refine_logs.fspipeline.autoproc %}
                            <div>
                                <a href="/logs/show/{{log_file}}" class="log-name" target="_blank">
                                    {{log_file.name}}
                                </a>
                            </div>
                        {% endfor %}
                    </div>
                    <div id="enda-fspipeline-v" class="tabcontent-vertical">
                        {% for log_file in refine_logs.fspipeline.edna %}
                            <div>
                                <a href="/logs/show/{{log_file}}" class="log-name" target="_blank">
                                    {{log_file.name}}
                                </a>
                            </div>
                        {% endfor %}
                    </div>
                    <div id="xds-fspipeline-v" class="tabcontent-vertical">
                        {% for log_file in refine_logs.fspipeline.xds %}
                            <div>
                                <a href="/logs/show/{{log_file}}" class="log-name" target="_blank">
                                    {{log_file.name}}
                                </a>
                            </div>
                        {% endfor %}
                    </div>
                    <div id="xdsapp-fspipeline-v" class="tabcontent-vertical">
                        {% for log_file in refine_logs.fspipeline.xdsapp %}
                            <div>
                                <a href="/logs/show/{{log_file}}" class="log-name" target="_blank">
                                    {{log_file.name}}
                                </a>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
</body>

<script>
function setup()
{
    function setup_modal_image(element_id)
    {
        const img = document.getElementById(element_id);
        if (img === null)
        {
            return;
        }

        /* insert image inside the modal */
        img.onclick = function()
        {
            modal.style.display = "block";
            modalImg.src = this.src;
        }
    }

    /* get the modal */
    var modal = document.getElementById('myModal');
    var modalImg = document.getElementById("img01");

    window.onclick = function(event)
    {
        if (event.target == modal)
        {
            modal.style.display = "none";
        }
    }

    setup_modal_image("diff1");
    setup_modal_image("diff2");
    setup_modal_image("snap1");
    setup_modal_image("snap2");
}

    const getCellValue = (tr, idx) => tr.children[idx].innerText || tr.children[idx].textContent;

    const comparer = (idx, asc) => (a, b) => ((v1, v2) =>
        v1 !== '' && v2 !== '' && !isNaN(v1) && !isNaN(v2) ? v1 - v2 : v1.toString().localeCompare(v2)
    )(getCellValue(asc ? a : b, idx), getCellValue(asc ? b : a, idx));

    // do the work...
    document.querySelectorAll('th').forEach(th => th.addEventListener('click', (() => {
        const table = th.closest('table');
        Array.from(table.querySelectorAll('tr:nth-child(n+2)'))
            .sort(comparer(Array.from(th.parentNode.children).indexOf(th), this.asc = !this.asc))
            .forEach(tr => table.appendChild(tr));
    })));

$(document).ready(setup);
</script>


<script>
    function openMethod(evt, methodName) {
        if (document.getElementById(methodName).style.display == "block") {
            document.getElementById(methodName).style.display = "none"
            evt.currentTarget.className = evt.currentTarget.className.replace(" active", '');
        } else {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(methodName).style.display = "block";
            evt.currentTarget.className += " active";
        }
    }
</script>

<script>
    function openMethodV(evt, methodName) {
        if (document.getElementById(methodName).style.display == "block") {
            document.getElementById(methodName).style.display = "none"
            evt.currentTarget.className = evt.currentTarget.className.replace(" active", '');
        } else {
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tabcontent-vertical");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tablinks-vertical");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(methodName).style.display = "block";
            evt.currentTarget.className += " active";
        }
    }
</script>
{% endblock %}
